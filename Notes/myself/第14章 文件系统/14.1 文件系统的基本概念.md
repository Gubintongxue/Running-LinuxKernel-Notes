### 第 14 章 文件系统

进程在运行期间可能需要保存一些数据，然而进程终止后，这些数据会随之丢失。为了解决数据持久化问题，操作系统通过文件系统将数据存储到磁盘中。文件系统作为对存储介质的抽象层，管理数据的组织、访问及存储。

#### 14.1 文件系统的基本概念

文件系统的核心在于提供用户友好的数据存储与检索方式。它通过文件与目录这两个基本单位来实现对数据的有序管理。

##### 14.1.1 文件

文件是文件系统的基本存储单位，用户可以通过文件方便地在磁盘上保存和读取信息。

1. **文件的命名**
   文件名通常由字母、数字和少量特殊字符组成。许多操作系统支持在文件名中使用扩展名（即文件名中的后缀），如 `.c` 表示 C 语言文件，`.txt` 表示文本文件等。
2. **文件类型**
   ==文件系统中常见的文件类型有：==
   - **普通文件**：存储用户数据的文件。
   - **目录文件**：==存储文件系统的结构信息。==
   - **特殊文件**：用于表示设备文件、系统节点（如 `procfs`、`sysfs`）等。
3. **文件属性**
   ==文件属性（或元数据）包括文件大小、权限、创建日期、修改日期等。==可以通过 Linux 的 `stat` 命令或 `stat()` 系统调用来查看文件属性。
4. **文件操作**
   ==文件操作是文件系统的核心，常见操作包括创建、打开、读取、写入、关闭、重命名和删除等：==
   - **打开文件**：使用 `open()` 打开或创建文件。
   - **关闭文件**：使用 `close()` 关闭文件。
   - **读取文件**：使用 `read()` 读取文件内容。
   - **写入文件**：使用 `write()` 将数据写入文件。
   - **定位文件位置**：`lseek()` 支持随机读写功能。
   - **获取文件属性**：`stat()` 函数获取文件的元数据。
   - **重命名文件**：`rename()` 改变文件名。
   - **删除文件**：`unlink()` 删除文件。

这些操作为用户提供了灵活的文件管理方式，能够满足多种数据存储与读取需求。

### 14.1.2 目录

目录用于管理文件系统的层次结构，存储文件的路径信息。目录包含目录项（如文件名及其位置等）以便操作系统能够快速定位文件。很多操作系统将目录本身视为一种文件，并支持层次化的目录结构（通常以树形结构展现），这种树形结构从根目录（通常标识为`/`）开始，逐层分布目录和文件。

==在树状结构目录系统中，有两种路径方式来指定文件或目录的位置：==

1. **绝对路径**：==从根目录开始的完整路径。==例如 `/usr/src/linux/vmlinux`，指从根目录开始，逐层访问 `usr`、`src` 和 `linux` 子目录，最后找到 `vmlinux` 文件。
2. **相对路径**：==以当前工作目录为起点，==不从根目录开始。例如在 `/home/user` 目录下，相对路径 `docs/file.txt` 指的是 `home/user/docs/file.txt` 文件。

树结构目录中通常有两个特殊目录项：

- **`.`**：表示当前目录。
- **`..`**：表示父目录。

#### ==目录操作==

目录和文件一样，也有一组操作方法，帮助用户和系统有效地管理文件系统结构：

- **创建目录**：例如使用 `mkdir` 创建新的目录。
- **删除目录**：如使用 `rmdir` 删除空目录。
- **打开目录**：通过 `opendir()` 函数打开目录。
- **关闭目录**：使用 `closedir()` 关闭打开的目录。
- **读取目录**：`readdir()` 函数遍历读取目录项。
- **修改目录名称**：通过 `rename()` 函数重命名目录。
- **建立目录链接**：可通过 `ln` 命令为目录创建软链接或硬链接。

这种目录结构和操作方法，使得文件系统具备层次性和灵活性，为用户提供了高效的数据存储与访问路径管理。